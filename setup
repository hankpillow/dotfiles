function backup {
  TARGET=$HOME/$1
  if [[ -e $TARGET ]];
  then
    cp -v "$TARGET" "$TARGET.$(date +%s).bkp"
  fi
}

if [ "$(uname)" == "Darwin" ]; then
  TMP_PROFILE=".bash_profile"
  TMP_OS="Mac"

elif [ "$(expr substr $(uname -s) 1 5)" == "Linux" ]; then
  TMP_PROFILE=".bashrc"
  TMP_OS="Linux"

fi

#-----

echo "downloading junegunn/vim-plug vim plugin manager..."
curl -# -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
backup ".vimrc"
cat ./vim/vimrc.vim > $HOME/.vimrc
echo "+ .vimrc updated"

if [[ "$1" == "install" ]];
then
    echo "+ Installing plugins"
    vim -c PlugInstall -c qall
    vim -u NONE -c "helptags vim-fugitive/doc" -c qall
fi

#------

backup ".gitconfig"
cat config/gitconfig > $HOME/.gitconfig
echo "+ .gitconfig updated"

#------

backup ".tmux.conf"
cat config/tmux.conf > $HOME/.tmux.conf
echo '+ .tmux.conf updated'

#------

backup ".ctags"
echo "downloading javacript ctags..."
curl -# -L https://raw.githubusercontent.com/romainl/ctags-patterns-for-javascript/master/.ctags > $HOME/.ctags

echo "downloading typescript ctags..."
curl -# -L https://raw.githubusercontent.com/jb55/typescript-ctags/master/.ctags >> $HOME/.ctags

cat config/ctags >> $HOME/.ctags
echo '+ .ctags updated'

#-----

backup ".bash_profile"
backup ".bashrc"

if [[ "$1" == "install" ]]; then

  echo "# FULL INSTALATION"

  echo "# updating git completion script..."
  mkdir ./profile/tmp

  curl -# -L https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash > profile/tmp/git-completion
  curl -# -L https://raw.githubusercontent.com/git/git/master/contrib/completion/git-prompt.sh > profile/tmp/git-prompt

  if [ $TMP_OS == "Darwin" ]; then

    echo "# updating docker completion script for mac..."
    brew install bash-completion
    curl -# -L https://raw.githubusercontent.com/docker/docker/master/contrib/completion/bash/docker > `brew --prefix`/etc/bash_completion.d/docker

  elif [ "$TMP_OS" == "Linux" ]; then

    echo "# updating docker completion script for linux..."
    curl -# -L https://raw.githubusercontent.com/docker/docker/master/contrib/completion/bash/docker > /etc/bash_completion.d/docker

  fi

  cat ./profile/tmp/* ./profile/*.sh > $HOME/$TMP_PROFILE
  rm -rf ./profile/tmp

else

  echo "# FAST SETUP"
  cat profile/*.sh > $HOME/$TMP_PROFILE

fi

echo "+ $TMP_PROFILE udpated."
bash $HOME/$TMP_PROFILE
echo "try running './remove_bkp' to cleanup *.bkp files at $HOME"
